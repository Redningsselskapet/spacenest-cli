version: v1beta10
images:
  app-demoapp:
    image: banker.azurecr.io/app-demoapp
    dockerfile: ./Dockerfile
    build:
      kaniko:
        cache: true
      disabled: true
deployments:
  - name: app-demoapp
    kubectl:
      manifests:
        - k8s/**
dev:
  ports:
    - imageName: app-demoapp
      forward:
        - port: 3000
  open:
    - url: http://localhost:3000
  sync:
    - imageName: app-demoapp
      disableDownload: false
      excludePaths:
        - .git/
      uploadExcludePaths:
        - node_modules
        - dist
        - k8s
  terminal:
    imageName: app-demoapp
    command:
      - ./devspace_start.sh
  replacePods:
    - imageName: app-demoapp
      replaceImage: loftsh/alpine:latest
      patches:
        - op: replace
          path: spec.containers[0].command
          value:
            - sleep
        - op: replace
          path: spec.containers[0].args
          value:
            - '9999999'
        - op: remove
          path: spec.containers[0].securityContext
profiles:
  - name: production
    patches:
      - op: remove
        path: images.app-demoapp.build.disabled
